# Configuration for profiling in Athena
#
# - Options are separated by lines, and values by coma ','
# - Write an option in multiple lines using backslash '\' at the end of the line
# - Use two single quotes '' to specify empty values.
#
# Avalaible keys are:
# - NAME     : Name of the test (mandatory)
# - ACTIVE   : Specify execution stage to perform
#              - Valid values are (you can combine them):
#                - Y: all execution stages: generation, running and analysis (default)
#                - N: no execution. Test will not be generated, run or analyzed. 
#                - G: only generation
#                - R: only running
#                - A: only analysis
# - PRESET   : Name of the preset for using as parameter in bfm_configure (see bfm_configure option '-p')
# - COPY     : Copy other generated test
#              - In generation time, The test will not be generated, only copied and deployed (bfm_configure option '-d')
#              - Source test must exists in tmp directory (use ACTIVE=G to only execute generation of source test) 
# - RUN      : Mode to run the experiment 
#              - Valid values are:
#                - sh:   default, for running in a unix shell
#                - bsub: for running in batch mode
# - RUNEXE   : Specify prototype for generating the experiment running script (see bfm_configure option '-R')
# - PROC     : Number of processors to use in execution (see bfm_configure option '-r')
# - ARCH     : Specify compilation Architecture file (see bfm_configure option '-a')
# - QUEUE    : Specify queue in job mode (see bfm_configure option '-q')
# - PAREXE   : Command to execute in parallel. Ex: openmpirun (see bfm_configure option '-e')
#              - You can use $PROC inside this command
# - PRECMD   : Commands to execute prior compiling and prior running
# - PRERUN   : Commands to execute prior running 
# - FORCING  : Forcing files to link in the run directory (see bfm_configure option '-i')
# - VALGRIND : Valgrind command and options for analysis
# - COMPARE  : Directory with test output to compare results
#              - Run command "nccmp -V" first to check if nccmp command works
# - COMPTHR  : Compare threshold for nccmp command (default 1e-3)

#NOTE: copy the nemo compilation options file: arch-gfortran_athena_xios_debug.fcm to NEMODIR/NEMOGCM/ARCH/CMCC/


NAME     = test_STD_PEL_M    , test_GYRE_BFM_MI       , test_GYRE_BFM_MG          , test_PELAGOS2_M           , test_PELAGOS2_OFF_M       ,
ACTIVE   = A                 , A                      , A                         , A                         , A                         ,
PRESET   = STANDALONE_PELAGIC, GYRE_BFM               , GYRE_BFM                  , PELAGOS2                  , PELAGOS2_OFF              ,
RUN      = bsub              , bsub                   , bsub                      , bsub                      , bsub                      ,
PROC     = ''                , ''                     , ''                        , 128                       , 128                       ,
ARCH     = gfortran_debug.inc, ifort_athena_xios_debug, gfortran_athena_xios_debug, gfortran_athena_xios_debug, gfortran_athena_xios_debug,
RUNEXE   = ''                , ''                     , ''                        , 'runscript'               , 'runscript'               ,
PAREXE   = ''                , ''                     , ''                        , 'mpirun.lsf'              , 'mpirun.lsf'              ,
QUEUE    = ''                , 'poe_long'             , 'poe_long'                , 'poe_long'                , 'poe_long'                ,

PRECMD   = export NETCDF=/users/home/ans040/local; export LD_LIBRARY_PATH=/users/home/ans040/local/lib:$LD_LIBRARY_PATH, \
           module load HDF5/hdf5-1.8.11_parallel NETCDF/netcdf-4.3_parallel NETCDF/parallel-netcdf-1.3.1, \
           export NETCDF=/users/home/ans040/local; export LD_LIBRARY_PATH=/users/home/ans040/local/lib:$LD_LIBRARY_PATH, \
           export NETCDF=/users/home/ans040/local; export LD_LIBRARY_PATH=/users/home/ans040/local/lib:$LD_LIBRARY_PATH, \
           export NETCDF=/users/home/ans040/local; export LD_LIBRARY_PATH=/users/home/ans040/local/lib:$LD_LIBRARY_PATH, 

FORCING = ''                                                                                           , \
          ''                                                                                           , \
          ''                                                                                           , \
          /work/ans040/FORCING/NEMO/*;/work/ans040/FORCING/BFM/*                                       , \
          /work/ans040/FORCING/NEMO/*;/work/ans040/FORCING/BFM/*;/work/ans040/FORCING/PELAGOS2_36_OFF/*, 

#change time in executables compiled with gfortran
#change iodef to be standalone (not server) in executables compiled with gfortran
PRERUN = ''                                                                                                                                                                                   , \
         ''                                                                                                                                                                                   , \
         ''                                                                                                                                                                                   , \
         cp $BFMDIR/tools/bfm_test/configurations/PROFILING_TESTS/pelagos_d_iodef.xml ./iodef.xml; cp $BFMDIR/tools/bfm_test/configurations/PROFILING_TESTS/pelagos_cfg ./namelist_cfg        , \
         cp $BFMDIR/tools/bfm_test/configurations/PROFILING_TESTS/pelagos_off_d_iodef.xml ./iodef.xml; cp $BFMDIR/tools/bfm_test/configurations/PROFILING_TESTS/pelagos_off_cfg ./namelist_cfg, 

COMPARE = '/users/home/ans040/dev/repo/bfm/tools/bfm_test/tmp/test_STD_PEL' , \
          '/users/home/ans040/dev/repo/bfm/tools/bfm_test/tmp/test_GYRE_BFM', \
          '/users/home/ans040/dev/repo/bfm/tools/bfm_test/tmp/test_GYRE_BFM', \
          '/users/home/ans040/dev/repo/bfm/tools/bfm_test/tmp/test_PELAGOS2', \
          ''                                                                , 

VALGRIND = valgrind --tool=massif --run-libc-freeres=no --stacks=yes, \
           valgrind --tool=massif --stacks=yes, \
           valgrind --tool=massif --run-libc-freeres=no --stacks=yes, \
           valgrind --tool=massif --run-libc-freeres=no --stacks=yes, \
           valgrind --tool=massif --run-libc-freeres=no --stacks=yes,
